# Daily cleanup job to scale old review apps to 0
name: Fly Review App Cleanup

on:
  schedule:
    # Run daily at 2 AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch: # Allow manual trigger for testing

# Minimal permissions for security - no GitHub API access needed
permissions: {}

jobs:
  cleanup-old-review-apps:
    name: Scale old review apps to 0
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'
      
      - name: Build cleanup tool
        run: |
          cd cmd/cleanup-review-apps
          go build -o cleanup-review-apps
      
      - name: Run cleanup
        run: ./cmd/cleanup-review-apps/cleanup-review-apps
        env:
          FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}
